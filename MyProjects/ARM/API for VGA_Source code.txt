/*********************************************************************************************************************************************************************	
	Title: An API for VGA.
   	Team members: Mefil D'Souza, Mohith Prabhu, N Akshay, Prajwal Sharma K
 	Description: In building an API for VGA we have used GPIO pins for sending the Hsync pulses and Vsync pulses, 2 bit value for Red, Green and Blue color. 
	The digital value generated by the GPIO pins will be connverted to analog output by using R-2R Ladder Circuit and then this output will be given to the 
	VGA port. 
*********************************************************************************************************************************************************************/

#include "macros.h"
#include <ulk.h>

int main(void) PROGRAM_ENTRY;

int main ()
{

	int Hsync_RGB;	

	//Initializing GPIO Ports
	ulk_proc_gpio_init();
	
	//GPIO Pins are made as ouput pins (pin nos. 1, 2 are used for red color, pin nos. 3, 4 are used for green color, pin nos. 6, 7 are used 
	//for blue color, pin no. 9 is used as Hsync and pin no. 22 is used as Vsync)
	ulk_proc_gpio_set_dir(140,0);		//pin no.-1
	ulk_proc_gpio_set_dir(141,0);		//pin no.-2
	ulk_proc_gpio_set_dir(142,0);		//pin no.-3
	ulk_proc_gpio_set_dir(143,0);		//pin no.-4
	ulk_proc_gpio_set_dir(158,0);		//pin no.-6
	ulk_proc_gpio_set_dir(162,0);		//pin no.-7
	ulk_proc_gpio_set_dir(161,0);		//pin no.-9 for Hsync
	ulk_proc_gpio_set_dir(22,0);		//pin no.-22 for Vsync
			
	//Data for the output is set as '1' which is black. When no Hsync and Vsync  signal is applied the screen appears black
	ulk_proc_gpio_set_data_out(140,1);		//pin no.-1
	ulk_proc_gpio_set_data_out(141,1);		//pin no.-2
	ulk_proc_gpio_set_data_out(142,1);		//pin no.-3
	ulk_proc_gpio_set_data_out(143,1);		//pin no.-4
	ulk_proc_gpio_set_data_out(158,1);		//pin no.-6
	ulk_proc_gpio_set_data_out(162,1);		//pin no.-7
			

	//super loop. This is an infinite loop
	for(;;)
	{

		//To generate the negative pulse of Vsync. The OFF time of Vsync is 64Useconds
		
			ulk_proc_gpio_set_data_out(22,0);
			ulk_proc_delay(ULK_USEC(64));		
	

	
		//To generate positive pulse of Vsync. The ON time of Vsync is 1020Useconds
		
			ulk_proc_gpio_set_data_out(22,1);
			ulk_proc_delay(ULK_USEC(1020));		
		


		//This loop is used because RGB colors have to be sent to the port for 480 cycles of Vsync
		for(Hsync_RGB=0;Hsync_RGB<480;Hsync_RGB++)
		{	

			//To generate negative pulse of Hsync. The OFF time of Hsync is 4Useconds
			
				ulk_proc_gpio_set_data_out(161,0);
				ulk_proc_delay(ULK_USEC(4));	
			

			//To generate positive pulse of Hsync. The ON time for Hsync is 2Useconds	
			
				ulk_proc_gpio_set_data_out(161,1);
				ulk_proc_delay(ULK_USEC(2));	
			
 		
	 		
			//The Hsync is given a positive pulse and white color is sent as RGB. The ON time for Hsync is 25Useconds
			
				ulk_proc_gpio_set_data_out(161,1);	//positive pulse for Hysnc
				//setting the GPIO pins to a output value
				ulk_proc_gpio_set_data_out(140,0);		//pin no.-1
				ulk_proc_gpio_set_data_out(141,0);		//pin no.-2
				ulk_proc_gpio_set_data_out(142,0);		//pin no.-3
				ulk_proc_gpio_set_data_out(143,0);		//pin no.-4
				ulk_proc_gpio_set_data_out(158,0);		//pin no.-6
				ulk_proc_gpio_set_data_out(162,0);		//pin no.-7
				ulk_proc_delay(ULK_USEC(25));			//positive pulse of Hsync to display RGB
				

			
			//To generate a positive pulse of Hsync. The ON time for Hsync is 1Useconds
			
			ulk_proc_gpio_set_data_out(161,1);
			ulk_proc_delay(ULK_USEC(1));	//positive pulse of Hsync 
			
		}

			
			//To generate the positive pulse of Vsync. The ON time is 450Useconds
			
			ulk_proc_gpio_set_data_out(22,1);
			ulk_proc_delay(ULK_USEC(450));	//positive pulse of Vsync
			


	}
return 0;
}


